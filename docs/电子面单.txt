快递电子面单的生成和打印
=======================

目前各大快递公司都推出了热敏电子面单服务，提高面单生成及追踪效率。Ecop平台也采用电子面单代替
传统的多联机打面单。

面单号的获取
------------

虽然各大快递公司都提供了对接文档，但逐一对接各快递平台太麻烦。因此需对接第三方电子面单平台。
目前最大最成熟的两个电子面单平台是菜鸟和快递鸟(kdniao.com)，两个平台在电子面单号获取方面目
前都是免费的。

菜鸟
....

菜鸟通过淘宝开放平台的电子面单API进行接入，目前支持“商家后台系统”类型的应用接入。但官方要求
是必须天猫商家而且是入驻聚石塔才能申请“商家后台系统"的应用权限。目前"大管家homemaster"帐号
之前申请的”大管家ERP"应用已通过报备，尚能正常使用，但有被随时停止的风险。

菜鸟平台获取加盟型快递公司的面单号时，需要先到淘宝后台"电子面单"处模块下添加相应的网点，
然后和网点联系向面单中充值，每取一个面单，剩余面单数将减１。已取未用的面单号，应回收。

使用菜鸟面单API的优点是可以很好地和菜鸟打印组件进行互动，方便面单的打印。

然而目前菜鸟平台对面单的后续跟踪没有好的解决方案。

快递鸟
......

物流鸟平台接入没有特别要求，获取加盟型快递公司面单需要先在相应快递公司设立账户，获得电子
面单接入帐号及密码。

在物流追踪方面，快递鸟提供了即时查询和订阅推送两种API。这些API可以对任意快递面单进行查询，
不一定非要是通过快递鸟API下的自己的订单号。

电子面单的打印
-------------

Ecop平台采用B/S结构，由于浏览器对js操纵用户打印机有限制，没法在无用于干预的情况下发送自动
进行打印，因此电子面单的自动批量打印可以采取以下几种方案:

 1. 在浏览器中安装打印控件，如lodop控件，通过控件操纵打印机。缺点是lodop有自己的页面语言，
    所有需打印的内容需要通过lodop页面语言进行描述，无法直接打印PDF文件。该方案优点是可以
    打印任何需要的内容。缺点除了需要安装浏览器控件外，还需要导入额外的javascript库文件。

 2. 使用菜鸟的云打印组建。该组件是单独运行的进程，和浏览器之间的通讯完全通过websocket协议，
    无需安装任何插件，运行云打印组件的电脑，也不需要是运行浏览器的电脑，因此可以实现手机
    浏览器打印，非常灵活，打印的内容也不一定是从cainiao API中返回的快递面但内容。同时打印
    成功与否还有状态返回，便于打印控制。但缺点是需要有淘宝账户并在云打印后台创建模板，只能
    根据模板打印，不能打印任意内容。

方案
----

综合以上情况，目前采取通过菜鸟平台进行下单，通过菜鸟云打印组件进行面单打印，通过快递鸟API
进行运单跟踪的综合方案。


